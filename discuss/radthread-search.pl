#**********************************************************************#* Program:      Hyperthread-LITE from Radiation                      *#* Module:       Search Engine Module                                 *#* Version:      1.0                                                  *#* Author:       Andrew Cowan (icculus@radiation.com) for Radiation   *#* Date:         January 7, 1997                                      *#* Product Info: http://www.radiation.com/gizmos/htlite.html          *#*                                                                    *#* This program is the copyrighted property of Radiation, a venture   *#* of GlobalMedia Design. Any use of this program is subject to the   *#* the terms of the license agreement (LICENSE.TXT) included as part  *#* of this distribution archive. Any other uses are stictly           *#* prohibited without the written permission of GlobalMedia Design    *#* and all other rights are reserved.                                 *#*                                                                    *#* Support for this software is available only to registered users.   *#* For registration information, consult the REGISTER.TXT document    *#* included as part of this distribution archive, or visit the Gizmos *#* section of the Radiation website at:                               *#*                                                                    *#*                http://www.radiation.com/gizmos/                    *#*                                                                    *#**********************************************************************# ************************************************************************# Module Subroutines Section# ************************************************************************# ************************************************************************# Search_Form - Print the search form# ************************************************************************sub search_form{   &print_header("Hyperthread :: Search Form");   &print_search_button_bar;   print <<"EOF";<center><h3>Hyperthread Search</h3></center><center><b><em>Enter a keyword...</em></b><form method="post" action="$cgi_url"><input type="hidden" name="mode" value="SEARCH"><input type="hidden" name="segment" value="0"><select name="maxhits"><option value="10">10 Hits<option value="25">25 Hits<option value="50">50 Hits<option value="100">100 Hits</select><input type="text" size="25" name="keyword"><input type="submit" value=" Search "></center></form>EOF   &print_search_button_bar;   &print_footer;}# ************************************************************************# Search - Perform the search# ************************************************************************sub search{   $start_index = ($segment * $maxhits);   $end_index = (($segment * $maxhits) + ($maxhits - 1));   $next_segment_hits = 0;   $curindex = 0;   foreach $area_key (@area_list){      next if (($area_key eq "USER") || ($area_key eq "PASSWORD"));      local($this_db) = $db_dir . "/" . $area_key;      dbmopen(%DB, $this_db, 0666);      %TDB = %DB;      dbmclose(DB);      while(($key, $val) = each(%TDB)){         if ($val !~ /(.*)\t(.*)\t(.*)\t(.*)\t(.*)\t(.*)\t(.*)\t(.*)/){            delete($TDB{$key});            next;         }         $search_status = "NO_MATCH";         local($num) = $key;         local($status) = $1;         next if $status =~ /EXPIRED/;          local($date) = $4;         local($poster) = $5;         local($email) = $6;         local($subject) = $7;                       local($message) = $8;            $message =~ s/`~``~`/<p>/g;         $message =~ s/`~`/ /g;          if (($poster =~ /$keyword/i) || ($email =~ /$keyword/i) ||            ($email =~ /$keyword/i) || ($subject =~ /$keyword/i) ||            ($message =~ /$keyword/i)){            $search_status = "MATCH";         }         if ($search_status eq "MATCH"){            if ($curindex >= $start_index){               local($item) = "" .                    "<a href=\"$cgi_url?mode=MSG&message=$num\"><b>$subject</b></a> " .                    "(<font size=-1><a href=\"mailto:$email\">" .                    "$poster</a></font>) $date";               $return_list[$curindex] = $item;               $curindex++;               $next_segment_hits++ if $curindex > ($end_index + 1);            }else{               $curindex++;            }         }      }   }   &print_header("Hyperthread :: Search Results");   &print_search_button_bar;   print "<center><h3>Hyperthread Search</h3></center>";   local($num_matches) = $curindex;   if ($#return_list < 0){      print "<center><h4>No matches were found</h4></center>";   }elsif ($#return_list == 0){      print "<center><h4>1 match was found for '<em>$keyword</em>'</h4>" .            "</center>\n" .            "<ul><ul><b>1.</b> $return_list[0]</ul></ul>\n";    }else{      $end_index = $#return_list if $#return_list < $end_index;      local($disp_start) = $start_index + 1;      local($disp_end) = $end_index + 1;      print "<center><h4>Displaying matches <b>$disp_start</b> to " .            "<b>$disp_end</b> for '<em>$keyword</em>'</h4></center>\n" .            "<ul><ol>";      for ($i = $start_index; $i <= $end_index; $i++){         local($disp_ind) = $i + 1;         print "<b>$disp_ind.</b> $return_list[$i]<br>\n";        }      print "</ol></ul>";      if ($next_segment_hits > 0){         $segment += 1;         $next_segment_hits = $maxhits if $next_segment_hits > $maxhits;         print "<form method=\"post\" action=\"$cgi_url\">" .               "<input type=\"hidden\" name=\"mode\" value=\"SEARCH\">" .               "<input type=\"hidden\" name=\"segment\" value=\"$segment\">" .               "<input type=\"hidden\" name=\"maxhits\" " .               "value=\"$maxhits\">" .               "<input type=\"hidden\" name=\"keyword\" value=\"$keyword\">" .               "<center><input type=\"submit\" " .               "value=\" Next $next_segment_hits Hits \"></center>";      }   }   &print_search_button_bar;   &print_footer;}# ************************************************************************1;  # Must return a true value to be required!# ************************************************************************# End of Module: Search # ************************************************************************