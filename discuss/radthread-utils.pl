#**********************************************************************#* Program:      Hyperthread-LITE from Radiation                      *#* Module:       Shared Utilities                                     *#* Version:      1.0                                                  *#* Author:       Andrew Cowan (icculus@radiation.com) for Radiation   *#* Date:         January 7, 1997                                      *#* Product Info: http://www.radiation.com/gizmos/htlite.html          *#*                                                                    *#* This program is the copyrighted property of Radiation, a venture   *#* of GlobalMedia Design. Any use of this program is subject to the   *#* the terms of the license agreement (LICENSE.TXT) included as part  *#* of this distribution archive. Any other uses are stictly           *#* prohibited without the written permission of GlobalMedia Design    *#* and all other rights are reserved.                                 *#*                                                                    *#* Support for this software is available only to registered users.   *#* For registration information, consult the REGISTER.TXT document    *#* included as part of this distribution archive, or visit the Gizmos *#* section of the Radiation website at:                               *#*                                                                    *#*                http://www.radiation.com/gizmos/                    *#*                                                                    *#**********************************************************************# ************************************************************************# Module Subroutines Section# ************************************************************************# ************************************************************************# Get_Date - Grab the system date and time, convert to normal format # ************************************************************************sub get_date{   local($date) = `date`;   $date =~ /(\S+)\s+(\S+)\s+(\S+)\s+(\d+):(\d+):(\d+).*/;   local($day) = $1;   local($month) = $2;   local($day2) = $3;   local($hour) = $4;   local($min) = $5;   local(%time_table) = ("01","1:$min AM","02","2:$min AM","03","3:$min AM",                  "04","4:$min AM","05","5:$min AM","06","6:$min AM",                  "07","7:$min AM","08","8:$min AM",                  "09","9:$min AM","10","10:$min AM","11",                  "11:$min AM","12","12:$min PM","13","1:$min PM",                  "14","2:$min PM","15","3:$min PM","16",                  "4:$min PM","17","5:$min PM","18","6:$min PM",                  "19","7:$min PM","20","8:$min PM","21",                  "9:$min PM","22","10:$min PM","23","11:$min PM",                  "00","12:$min AM");      $date_line = "$day $month $day2 [$time_table{$hour}]" ;}# ************************************************************************# Print_Header - Prints the header to STDOUT # ************************************************************************sub print_header{   local($title) = $_[0];   $title = "Radiation's Hyperthread System" if $title eq "";   print <<"EOF";<html><head><title>$title</title></head><body bgcolor=#FFFFFF text=#000000><center><a href="http://www.radzone.org/gmd-bin/radiation"><img align=middle border=0 src="$image_base/ratom3.gif"></a><a href="http://www.radzone.org/gmd/isystems.html"><img align=middle src="$image_base/isystem2.gif" border=0></a><B><FONT SIZE=+1>HyperThread</FONT><FONT SIZE=-1>tm</FONT><FONT SIZE=+1> Discussions</FONT></B><HR></center>EOF}# ************************************************************************# Print_Footer - Send the standard footer to STDOUT # ************************************************************************sub print_footer{   if ($back eq "ADMIN"){      print "<p><center>" .            "<form method=\"post\" action=\"$ENV{'HTTP_REFERER'}\">" .            "<input type=\"hidden\" name=\"id\" value=\"$id\">" .            "<input type=\"hidden\" name=\"pwd\" value=\"$pwd\">" .            "<input type=\"hidden\" name=\"mode\" value=\"Maintain\">" .            "<input type=\"hidden\" name=\"area\" value=\"$area\">" .            "<input type=\"submit\" value=\"Back to Administration Panel\">" .            "</form></center>";   }   print <<"EOF";<P><center><a href="http://www.radzone.org/gmd-bin/radiation"><img border=0 src="$image_base/ratom3.gif"></a><BR><font size=-2>Hyperthread and the contents of this discussion forum are copyright &copy 1996<BR> by <a href="http://www.radzone.org/gmd-bin/radiation">radiation</a>, a service mark of <a href="http://www.radzone.org/gmd/">GlobalMedia Design Inc.</a> All Rights Reserved.</font></center><p></body></html>EOF}# ************************************************************************# Print_Area_Button_Bar - Prints the Areas button bar to browser # ************************************************************************sub print_area_button_bar{   local($this_area, $this_msg) = @_;   print <<"EOF";<center><img border=0 src="$image_base/prev2.gif"><img border=0 src="$image_base/next2.gif"><a href="$cgi_url?mode=POST"><img border=0 src="$image_base/post1.gif"></a><img border=0 src="$image_base/reply2.gif"><img border=0 src="$image_base/sum2.gif"><a href="$cgi_url?mode=SFORM"><img border=0 src="$image_base/search1.gif"></a><a href="$cgi_url?mode=HELP"><img border=0 src="$image_base/help1.gif"></a></center><P>EOF}# ************************************************************************# Print_Post_Button_Bar - Prints the Post form button bar to browser # ************************************************************************sub print_post_button_bar{   local($this_area, $this_msg) = @_;   print <<"EOF";<center><img border=0 src="$image_base/prev2.gif"><img border=0 src="$image_base/next2.gif"><img border=0 src="$image_base/post2.gif"><img border=0 src="$image_base/reply2.gif"><a href="$cgi_url?mode=AREA"><img border=0 src="$image_base/sum1.gif"></a><a href="$cgi_url?mode=SFORM"><img border=0 src="$image_base/search1.gif"></a><a href="$cgi_url?mode=HELP"><img border=0 src="$image_base/help1.gif"></a></center><P>EOF}# ************************************************************************# Print_Msg_Button_Bar - Prints the Msg form button bar to browser # ************************************************************************sub print_msg_button_bar{   local($this_area, $this_msg) = @_;   local($next) = &check_reply($this_msg);   if ($next eq "NONE"){      $next_line = "<img border=0 src=\"$image_base/next2.gif\">";   }else{      $next_line = "<a href=\"$cgi_url?mode=MSG&message=$next\"><img border=0 src=\"$image_base/next1.gif\"></a>"   }   local($prev) = &check_prev($this_msg);   if ($prev eq "NONE"){      $prev_line = "<img border=0 src=\"$image_base/prev2.gif\">";   }else{      $prev_line = "<a href=\"$cgi_url?mode=MSG&message=$prev\"><img border=0 src=\"$image_base/prev1.gif\"></a>"   }   print <<"EOF";<center>$prev_line$next_line<a href="$cgi_url?mode=POST"><img border=0 src="$image_base/post1.gif"></a><a href="$cgi_url?mode=REPLY&message=$this_msg"><img border=0 src="$image_base/reply1.gif"></a><a href="$cgi_url?mode=AREA"><img border=0 src="$image_base/sum1.gif"></a><a href="$cgi_url?mode=SFORM"><img border=0 src="$image_base/search1.gif"></a><a href="$cgi_url?mode=HELP"><img border=0 src="$image_base/help1.gif"></a></center><P>EOF}# ************************************************************************# Print_Search_Button_Bar - Prints the Search button bar to browser # ************************************************************************sub print_search_button_bar{   print <<"EOF";<center><img border=0 src="$image_base/prev2.gif"><img border=0 src="$image_base/next2.gif"><img border=0 src="$image_base/post2.gif"></a><img border=0 src="$image_base/reply2.gif"><a href="$cgi_url?mode=AREA"><img border=0 src="$image_base/sum1.gif"></a><a href="$cgi_url?mode=SFORM"><img border=0 src="$image_base/search1.gif"></a><a href="$cgi_url?mode=HELP"><img border=0 src="$image_base/help1.gif"></a></center><P>EOF}# ************************************************************************# Update_DB - Save the database # ************************************************************************sub update_db{   local($which_db) = $_[0];   dbmopen(%DB, $which_db, 0666);   %DB = %TDB;   dbmclose(DB);}# ************************************************************************# Load_Areas - Read areas information from the areas database # ************************************************************************sub load_areas{   $#area_list = -1;   dbmopen(%DB, $areas_db, 0666);   %TDB = %DB;   dbmclose(DB);   foreach $key (keys(%TDB)){      next if (($key eq "USER") || ($key eq "PASSWORD"));      if ($TDB{$key} !~ /(.*)\t(.*)/){         delete $TDB{$key};         next;      }            push(@area_list, $key);      $area_name{$key} = $1;      $area_desc{$key} = $2;   }}# ************************************************************************# Print_Menu - Use the loaded area info to construct and display the menu # ************************************************************************sub print_menu{   print <<"EOF";<B>Welcome to Radiation's prototype Hyperthread system, a threaded web-based discussion group engine. We are maintaining a number of technical support and user networking conferences related to our <a href="http://www.radzone.org/gmd/isystems.html">Intelligent Systems</a> line of web products.<p><B><center><table border=0 width=80%><tr><td>EOF   foreach $key (@area_list){     print <<"EOF";<h2><b><a href="$cgi_url?mode=AREA">$area_name{$key}</a></b></h2><ul>$area_desc{$key}</ul>EOF   }   print "</td></tr></table></center>";}# ************************************************************************# Interpret -  Determine which area to jump to# ************************************************************************sub interpret{   &print_header("Hyperthread: $area_name{$area}");   &message_handler($area);   &print_footer;}# ************************************************************************# Check_For_Missing - Check for missing fields on a message post# ************************************************************************sub check_for_missing{   local($missing) = "";   if ($name eq ""){      $missing = "Your Name";   }   if ($email eq ""){      $missing .= ", Your Email Address" unless $missing eq "";      $missing = "Your Email Address" if $missing eq "";   }   if ($subject eq ""){      $missing .= ", The Message Subject" unless $missing eq "";      $missing = "The Message Subject" if $missing eq "";   }   if ($message_body eq ""){      $missing .= ", The Message Body" unless $missing eq "";      $missing = "The Message Body" if $missing eq "";   }   return $missing;}# ************************************************************************1;  # Must return a true value to be required!# ************************************************************************# End of Module: Utilities # ************************************************************************